<ddaplib-header iconClass="icon icon-passport" label="Consents">
</ddaplib-header>

<ddaplib-main>
  <ng-container *ngIf="(consents$ | async) as consentsResponse">
    <table mat-table [dataSource]="consentsResponse.consents"
           class="table--base mat-elevation-z1">
      <!-- Name Definition -->
      <ng-container matColumnDef="name" sticky>
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let model"
            data-se="entity-title">
          {{ model.name }}
        </td>
      </ng-container>
      <!-- User Definition -->
      <ng-container matColumnDef="user">
        <th mat-header-cell *matHeaderCellDef>User</th>
        <td mat-cell *matCellDef="let model">{{ model.user }}</td>
      </ng-container>
      <!-- Client Definition -->
      <ng-container matColumnDef="client">
        <th mat-header-cell *matHeaderCellDef>Client</th>
        <td mat-cell *matCellDef="let model">{{ model.client }}</td>
      </ng-container>
      <!-- Items Definition -->
      <ng-container matColumnDef="items">
        <th mat-header-cell *matHeaderCellDef>Items</th>
        <td mat-cell *matCellDef="let model">
        <span *ngFor="let item of model.items">
          {{ item }}
          <br/>
        </span>
        </td>
      </ng-container>
      <!-- Scopes Definition -->
      <ng-container matColumnDef="scopes">
        <th mat-header-cell *matHeaderCellDef>Scopes</th>
        <td mat-cell *matCellDef="let model">
        <span *ngFor="let scope of model.scopes">
          {{ scope }}
          <br/>
        </span>
        </td>
      </ng-container>
      <!-- Resources Definition -->
      <ng-container matColumnDef="resources">
        <th mat-header-cell *matHeaderCellDef>Resources</th>
        <td mat-cell *matCellDef="let model">
        <span *ngFor="let scope of model.resources">
          {{ scope }}
          <br/>
        </span>
        </td>
      </ng-container>
      <!-- More Actions Column -->
      <ng-container matColumnDef="moreActions" stickyEnd>
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let model"
            class="table--actions">
          <mat-icon [matMenuTriggerFor]="moreActionsMenu"
                    [matMenuTriggerData]="{ id: model.name }"
                    data-se="btn-more-actions">
            more_vert
          </mat-icon>
        </td>
      </ng-container>

      <mat-menu #moreActionsMenu="matMenu">
        <ng-template matMenuContent
                     let-id="id">
          <button mat-menu-item
                  class="color--warn"
                  data-se="btn-revoke"
                  (click)="revokeConsent(id)">
            Revoke
          </button>
        </ng-template>
      </mat-menu>

      <!-- Header and Row Declarations -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </ng-container>
</ddaplib-main>
