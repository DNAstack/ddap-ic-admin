<ddaplib-header iconClass="icon icon-settings" label="Options">

</ddaplib-header>

<ddaplib-main>
  <ddaplib-entity-description>
    Configuration of the Identity Concentrator, such as the time before expiry of various tokens.
  </ddaplib-entity-description>

  <ng-container *ngIf="options$ | async as options">
    <!-- FIXME: find better place to display error -->
    <p>
      <mat-error>{{ error }}</mat-error>
    </p>
    <table mat-table [dataSource]="options.descriptors | keyvalue"
           class="table--base mat-elevation-z1">
      <!-- Label Definition -->
      <ng-container matColumnDef="label" sticky>
        <th mat-header-cell *matHeaderCellDef>Label</th>
        <td mat-cell *matCellDef="let model"
            data-se="entity-title">
          {{ model.value.label }}
        </td>
      </ng-container>
      <!-- Description Definition -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let model">{{ model.value.description }}</td>
      </ng-container>
      <!-- Type Definition -->
      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef>Type</th>
        <td mat-cell *matCellDef="let model">{{ model.value.type }}</td>
      </ng-container>
      <!-- Default Value Definition -->
      <ng-container matColumnDef="defaultValue">
        <th mat-header-cell *matHeaderCellDef>Default Value</th>
        <td mat-cell *matCellDef="let model">{{ model.value.defaultValue }}</td>
      </ng-container>
      <!-- Value Definition -->
      <ng-container matColumnDef="value">
        <th mat-header-cell *matHeaderCellDef>Value</th>
        <td mat-cell *matCellDef="let model">
          <ng-container *ngIf="currentlyEditing === model.key; else readonlyMode">
            <form class="flex vertical-center">
              <mat-form-field appearance="outline">
                <mat-label>Value</mat-label>
                <input #valueInput="matInput"
                       [value]="options[model.key]"
                       [attr.data-se]="'inp-' + model.key"
                       matInput>
              </mat-form-field>
              <button mat-button
                      color="primary"
                      (click)="updateOptionValue(options, model.key, valueInput.value)"
                      data-se="btn-save">
                Save
              </button>
            </form>
          </ng-container>
          <ng-template #readonlyMode>
            <span data-se="option-value">{{ options[model.key] }}</span>
          </ng-template>
        </td>
      </ng-container>
      <!-- More Actions Column -->
      <ng-container matColumnDef="moreActions" stickyEnd>
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let model"
            class="table--actions">
          <mat-icon [matMenuTriggerFor]="moreActionsMenu"
                    [matMenuTriggerData]="{ id: model.key }"
                    data-se="btn-more-actions">
            more_vert
          </mat-icon>
        </td>
      </ng-container>

      <mat-menu #moreActionsMenu="matMenu">
        <ng-template matMenuContent
                     let-id="id">
          <button mat-menu-item
                  (click)="currentlyEditing = id"
                  data-se="btn-edit">
            Edit
          </button>
        </ng-template>
      </mat-menu>

      <!-- Header and Row Declarations -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </ng-container>
</ddaplib-main>

