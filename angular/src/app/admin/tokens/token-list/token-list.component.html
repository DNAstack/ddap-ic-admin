<ddaplib-header iconClass="icon icon-clients" label="Sessions">
</ddaplib-header>

<ddaplib-main>
  <ng-container *ngIf="(tokens$ | async) as tokensResponse">
    <table mat-table [dataSource]="tokensResponse.tokens"
           class="table--base mat-elevation-z1">
      <!-- Name Definition -->
      <ng-container matColumnDef="name" sticky>
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let token"
            data-se="entity-title">
          {{ token.name }}
        </td>
      </ng-container>
      <!-- Description Definition -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let token">{{ token.metadata.client_desc }}</td>
      </ng-container>
      <!-- Scope Definition -->
      <ng-container matColumnDef="scopes">
        <th mat-header-cell *matHeaderCellDef>Scopes</th>
        <td mat-cell *matCellDef="let token">
        <span *ngFor="let scope of token.scope.split(' ')">
          {{ scope }}
          <br/>
        </span>
        </td>
      </ng-container>
      <!-- Expires At Definition -->
      <ng-container matColumnDef="expiresAt">
        <th mat-header-cell *matHeaderCellDef>Expires At</th>
        <td mat-cell *matCellDef="let token">{{ token.expires_at }}</td>
      </ng-container>
      <!-- Issued At Definition -->
      <ng-container matColumnDef="issuedAt">
        <th mat-header-cell *matHeaderCellDef>Issued At</th>
        <td mat-cell *matCellDef="let token">{{ token.issued_at }}</td>
      </ng-container>
      <!-- Client Definition -->
      <ng-container matColumnDef="client">
        <th mat-header-cell *matHeaderCellDef>Client</th>
        <td mat-cell *matCellDef="let token">{{ token.client.name }}</td>
      </ng-container>
      <!-- More Actions Column -->
      <ng-container matColumnDef="moreActions" stickyEnd>
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let token"
            class="table--actions">
          <mat-icon [matMenuTriggerFor]="moreActionsMenu"
                    [matMenuTriggerData]="{ id: token.name }">
            more_vert
          </mat-icon>
        </td>
      </ng-container>

      <mat-menu #moreActionsMenu="matMenu">
        <ng-template matMenuContent
                     let-id="id">
          <button mat-menu-item
                  class="color--warn"
                  (click)="revokeToken(id)">
            Revoke
          </button>
        </ng-template>
      </mat-menu>

      <!-- Header and Row Declarations -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </ng-container>
</ddaplib-main>
